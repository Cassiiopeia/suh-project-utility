<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head(title='Grass Planter - GitHub 자동 커밋 관리')}"></head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="ui container grass-planter-dashboard" id="main-content">
    <!-- 페이지 헤더 -->
    <div class="ui segment">
        <h2 class="ui header">
            <i class="github icon"></i>
            <div class="content">
                Grass Planter
                <div class="sub header">GitHub 자동 커밋 관리 시스템</div>
            </div>
        </h2>
    </div>

    <!-- 프로필 카드 섹션 -->
    <div class="ui segment">
        <div class="header-with-button">
            <div>
                <h3 class="grass-section-header">
                    <i class="github icon"></i>
                    프로필 목록
                </h3>
                <p class="dashboard-section-description">등록된 GitHub 프로필 관리</p>
            </div>
            <button class="ui primary button" onclick="showAddProfileModal()">
                <i class="plus icon"></i> 프로필 추가
            </button>
        </div>

        <div class="ui four column doubling stackable grid">
            <!-- 프로필 카드들 -->
            <div class="column" th:each="profile : ${profiles}">
                <div class="ui fluid card equal-height-card">
                    <div class="content">
                        <!-- 프로필 헤더 -->
                        <div class="grass-profile-header">
                            <div class="profile-name">
                                <i class="github icon"></i>
                                <span th:text="${profile.githubUsername}">username</span>
                            </div>
                            <div>
                                <div th:if="${profile.isActive}" class="ui green circular mini label">활성</div>
                                <div th:unless="${profile.isActive}" class="ui grey circular mini label">비활성</div>
                            </div>
                        </div>
                        
                        <!-- 저장소 이름 -->
                        <div class="meta">
                            <span class="date" th:text="${profile.defaultRepositoryName ?: 'No repository'}">repository</span>
                        </div>
                        
                        <!-- 주요 정보 영역 -->
                        <div class="grass-profile-info">
                            <div class="info-item">
                                <i class="clock icon"></i>
                                <span th:text="${profile.isAutoCommitEnabled ? '자동 커밋' : '수동 커밋'}">자동 커밋</span>
                            </div>
                            
                            <div class="contribution-level-display">
                                <span class="contribution-level" th:classappend="'level-' + ${profile.targetCommitLevel ?: 0}"></span>
                                <span class="level-text">레벨 <span th:text="${profile.targetCommitLevel ?: 0}">1</span></span>
                            </div>
                            
                            <div class="info-item">
                                <i class="user icon"></i>
                                <span th:text="${profile.ownerNickname ?: '미지정'}">Cassiopeia</span>
                            </div>
                        </div>
                        
                        <!-- 버튼 영역 -->
                        <div class="grass-profile-actions">
                            <button class="ui circular icon green button" 
                                    th:data-profile-id="${profile.grassProfileId}"
                                    onclick="executeCommit(this.getAttribute('data-profile-id'))"
                                    data-tooltip="커밋 실행"
                                    data-position="top center">
                                <i class="play icon"></i>
                            </button>
                            <button class="ui circular icon blue button" 
                                    th:data-profile-id="${profile.grassProfileId}"
                                    onclick="editProfile(this.getAttribute('data-profile-id'))"
                                    data-tooltip="프로필 수정"
                                    data-position="top center">
                                <i class="edit icon"></i>
                            </button>
                            <button class="ui circular icon red button" 
                                    th:data-profile-id="${profile.grassProfileId}"
                                    onclick="deleteProfile(this.getAttribute('data-profile-id'))"
                                    data-tooltip="프로필 삭제"
                                    data-position="top center">
                                <i class="trash icon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 커밋 로그 섹션 -->
    <div class="ui segment">
        <div class="header-with-button">
            <div>
                <h3 class="grass-section-header">
                    <i class="history icon"></i>
                    커밋 로그
                </h3>
                <p class="dashboard-section-description">최근 커밋 기록</p>
            </div>
            <button class="ui blue button" onclick="loadCommitLogs()">
                <i class="refresh icon"></i> 새로고침
            </button>
        </div>
        
        <table class="ui celled table commit-log-table">
            <thead>
                <tr>
                    <th>시간</th>
                    <th>프로필</th>
                    <th>저장소</th>
                    <th>메시지</th>
                    <th>상태</th>
                    <th>레벨</th>
                </tr>
            </thead>
            <tbody id="commitLogTable">
                <tr>
                    <td colspan="6" class="center aligned">
                        <div class="ui active inline loader"></div>
                        로그 로딩 중...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 프로필 추가/수정 모달 -->
    <div class="ui modal" id="profileModal">
        <i class="close icon"></i>
        <div class="header">
            <i class="github icon"></i>
            GitHub 프로필 설정
        </div>
        <div class="content">
            <form class="ui form" id="profileForm">
                <input type="hidden" id="profileId" name="profileId">
                
                <div class="two fields">
                    <div class="field">
                        <label>GitHub 사용자명</label>
                        <input type="text" id="githubUsername" name="githubUsername" 
                               placeholder="예: octocat" required>
                    </div>
                    <div class="field">
                        <label>Personal Access Token (PAT)</label>
                        <input type="password" id="personalAccessToken" name="personalAccessToken" 
                               placeholder="ghp_xxxxxxxxxxxx">
                    </div>
                </div>
                
                <div class="two fields">
                    <div class="field">
                        <label>저장소 전체 이름</label>
                        <input type="text" id="repositoryFullName" name="repositoryFullName" 
                               placeholder="예: username/repository">
                    </div>
                    <div class="field">
                        <label>목표 커밋 레벨</label>
                        <select class="ui dropdown" id="targetCommitLevel" name="targetCommitLevel">
                            <option value="1">레벨 1 (연한 녹색)</option>
                            <option value="2">레벨 2 (녹색)</option>
                            <option value="3">레벨 3 (진한 녹색)</option>
                            <option value="4">레벨 4 (매우 진한 녹색)</option>
                        </select>
                    </div>
                </div>
                
                <div class="two fields">
                    <div class="field">
                        <label>담당자 닉네임</label>
                        <input type="text" id="ownerNickname" name="ownerNickname" 
                               placeholder="담당자 이름">
                    </div>
                    <div class="field">
                        <label>설정</label>
                        <div class="ui segment">
                            <div class="ui toggle checkbox">
                                <input type="checkbox" id="isActive" name="isActive" checked>
                                <label>프로필 활성화</label>
                            </div>
                            <br><br>
                            <div class="ui toggle checkbox">
                                <input type="checkbox" id="isAutoCommitEnabled" name="isAutoCommitEnabled">
                                <label>자동 커밋 활성화</label>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="actions">
            <div class="ui black deny button">
                취소
            </div>
            <div class="ui positive right labeled icon button" onclick="saveProfile()">
                저장
                <i class="checkmark icon"></i>
            </div>
        </div>
    </div>

    <!-- 커밋 실행 모달 -->
    <div class="ui small modal" id="commitModal">
        <i class="close icon"></i>
        <div class="header">
            <i class="play icon"></i>
            수동 커밋 실행
        </div>
        <div class="content">
            <form class="ui form" id="commitForm">
                <input type="hidden" id="commitProfileId" name="profileId">
                <div class="field">
                    <label>커밋 메시지</label>
                    <textarea id="commitMessage" name="commitMessage" rows="3" 
                              placeholder="커밋 메시지를 입력하세요..."></textarea>
                </div>
            </form>
        </div>
        <div class="actions">
            <div class="ui black deny button">
                취소
            </div>
            <div class="ui positive right labeled icon button" onclick="confirmCommit()">
                실행
                <i class="play icon"></i>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<!-- JavaScript 로직은 common.js에서 처리됩니다 -->
</body>
</html>