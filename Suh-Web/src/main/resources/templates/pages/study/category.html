<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head(title=${category.name + ' - SAECHAN-LAB'})}"></head>
<body class="study-page category-page">
<div th:replace="~{fragments/header :: header}"></div>

<div class="ui container" id="main-content">
  <div class="ui segment">
    <!-- 카테고리 헤더 -->
    <div class="category-header">
      <h2 class="ui header">
        <i th:class="${category.icon != null ? category.icon : 'folder'} + ' icon'"
           th:style="${category.color != null ? 'color:' + category.color : ''}"></i>
        <div class="content" th:text="${category.name}">
          <div class="sub header" th:text="${category.description}"></div>
        </div>
      </h2>
      
      <!-- 상위 카테고리 표시 (있는 경우) -->
      <div class="category-breadcrumb" th:if="${category.parentId != null}">
        <div class="ui breadcrumb">
          <a class="section" href="/study-management">홈</a>
          <i class="right angle icon divider"></i>
          <a class="section" th:href="@{/study-management/category/{id}(id=${category.parentId})}" 
             th:text="${category.parentName}"></a>
          <i class="right angle icon divider"></i>
          <div class="active section" th:text="${category.name}"></div>
        </div>
      </div>
      
      <!-- 작업 버튼 -->
      <div class="category-actions">
        <a th:href="@{/study-management/post/create(categoryId=${category.id})}" class="ui blue button">
          <i class="plus icon"></i> 새 포스트 작성
        </a>
      </div>
    </div>
    
    <!-- 하위 카테고리 목록 -->
    <div class="subcategories-section" th:if="${!category.children.isEmpty()}">
      <div class="ui divider"></div>
      <h3 class="ui header">하위 카테고리</h3>
      
      <div class="ui cards">
        <div class="card" th:each="subCategory : ${category.children}">
          <div class="content">
            <div class="header">
              <i th:class="${subCategory.icon != null ? subCategory.icon : 'folder'} + ' icon'"
                 th:style="${subCategory.color != null ? 'color:' + subCategory.color : ''}"></i>
              <a th:href="@{/study-management/category/{id}(id=${subCategory.id})}" th:text="${subCategory.name}"></a>
            </div>
            <div class="meta" th:text="${#temporals.format(subCategory.createdDate, 'yyyy-MM-dd')}"></div>
            <div class="description" th:text="${subCategory.description != null ? subCategory.description : '설명 없음'}"></div>
          </div>
          <div class="extra content">
            <span>
              <i class="file icon"></i>
              포스트 <span th:text="${subCategory.postCount != null ? subCategory.postCount : 0}"></span>개
            </span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 포스트 목록 -->
    <div class="posts-section">
      <div class="ui divider"></div>
      <h3 class="ui header">포스트 목록</h3>
      
      <!-- 포스트가 없는 경우 -->
      <div class="ui info message" th:if="${posts == null || posts.isEmpty()}">
        <p>이 카테고리에는 아직 포스트가 없습니다.</p>
        <a th:href="@{/study-management/post/create(categoryId=${category.id})}" class="ui small blue button">
          <i class="plus icon"></i> 첫 포스트 작성하기
        </a>
      </div>
      
      <!-- 포스트 목록 -->
      <div class="ui divided items" th:unless="${posts == null || posts.isEmpty()}">
        <div class="item" th:each="post : ${posts}">
          <!-- 썸네일 이미지 (이미지 첨부 파일이 있는 경우) -->
          <div class="image" th:if="${post.attachments != null && !post.attachments.isEmpty() && post.attachments[0].isImage}">
            <img th:src="${post.attachments[0].fileUrl}" alt="썸네일">
          </div>
          
          <div class="content">
            <a th:href="@{/study-management/post/{id}(id=${post.id})}" class="header" th:text="${post.title}"></a>
            <div class="meta">
              <span th:text="${post.author != null ? post.author : '익명'}"></span>
              <span th:text="${#temporals.format(post.createdDate, 'yyyy-MM-dd HH:mm')}"></span>
              <span th:text="${'조회 ' + post.viewCount}"></span>
            </div>
            <div class="description" th:text="${post.summary != null ? post.summary : (post.content.length() > 200 ? post.content.substring(0, 200) + '...' : post.content)}"></div>
            <div class="extra">
              <!-- 태그 표시 -->
              <div class="ui right floated" th:if="${post.tagList != null && !post.tagList.isEmpty()}">
                <span th:each="tag : ${post.tagList}" class="ui tiny label" th:text="${tag}"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 페이지네이션 -->
      <div class="ui center aligned container" th:if="${totalPages > 1}">
        <div class="ui pagination menu">
          <!-- 이전 페이지 -->
          <a class="item" th:classappend="${currentPage == 0 ? 'disabled' : ''}"
             th:href="@{/study-management/category/{id}(id=${category.id},page=${currentPage - 1})}">
            <i class="angle left icon"></i>
          </a>
          
          <!-- 페이지 번호 -->
          <a class="item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
             th:classappend="${i == currentPage ? 'active' : ''}"
             th:href="@{/study-management/category/{id}(id=${category.id},page=${i})}"
             th:text="${i + 1}"></a>
          
          <!-- 다음 페이지 -->
          <a class="item" th:classappend="${currentPage == totalPages - 1 ? 'disabled' : ''}"
             th:href="@{/study-management/category/{id}(id=${category.id},page=${currentPage + 1})}">
            <i class="angle right icon"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<script>
  $(document).ready(function() {
    // 카테고리 페이지 관련 JavaScript 코드
  });
</script>
</body>
</html>
