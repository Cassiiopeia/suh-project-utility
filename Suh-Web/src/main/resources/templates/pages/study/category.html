<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head(title=${category.name + ' - SAECHAN-LAB'})}"></head>
<body class="study-page category-page">
<div th:replace="~{fragments/header :: header}"></div>

<div class="container mx-auto px-4 py-6" id="main-content">
  <div class="card bg-base-100 shadow">
    <div class="card-body">
      <!-- 카테고리 헤더 -->
      <div class="category-header mb-6">
        <h2 class="text-2xl font-bold mb-2">
          <i th:class="'fa-solid fa-' + (${category.icon != null ? category.icon.replace(' icon', '').replace(' ', '-') : 'folder'})"
             th:style="${category.color != null ? 'color:' + category.color : ''}"></i>
          <span th:text="${category.name}"></span>
        </h2>
        <p class="text-gray-500" th:text="${category.description}"></p>
        
        <!-- 상위 카테고리 표시 (있는 경우) -->
        <div class="category-breadcrumb mt-2" th:if="${category.parentId != null}">
          <div class="breadcrumbs text-sm">
            <ul>
              <li><a href="/study-management">홈</a></li>
              <li><a th:href="@{/study-management/category/{id}(id=${category.parentId})}" 
                     th:text="${category.parentName}"></a></li>
              <li th:text="${category.name}"></li>
            </ul>
          </div>
        </div>
        
        <!-- 작업 버튼 -->
        <div class="category-actions mt-4">
          <a th:href="@{/study-management/post/create(categoryId=${category.id})}" class="btn btn-primary">
            <i class="fa-solid fa-plus"></i> 새 포스트 작성
          </a>
        </div>
      </div>
      
      <!-- 하위 카테고리 목록 -->
      <div class="subcategories-section mb-6" th:if="${!category.children.isEmpty()}">
        <div class="divider"></div>
        <h3 class="text-xl font-bold mb-4">하위 카테고리</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="card bg-base-100 shadow" th:each="subCategory : ${category.children}">
            <div class="card-body">
              <h4 class="card-title">
                <i th:class="'fa-solid fa-' + (${subCategory.icon != null ? subCategory.icon.replace(' icon', '').replace(' ', '-') : 'folder'})"
                   th:style="${subCategory.color != null ? 'color:' + subCategory.color : ''}"></i>
                <a th:href="@{/study-management/category/{id}(id=${subCategory.id})}" th:text="${subCategory.name}" class="link"></a>
              </h4>
              <p class="text-sm text-gray-500" th:text="${#temporals.format(subCategory.createdDate, 'yyyy-MM-dd')}"></p>
              <p class="text-gray-600" th:text="${subCategory.description != null ? subCategory.description : '설명 없음'}"></p>
              <div class="card-actions justify-end mt-2">
                <span class="text-sm text-gray-500">
                  <i class="fa-solid fa-file"></i>
                  포스트 <span th:text="${subCategory.postCount != null ? subCategory.postCount : 0}"></span>개
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    
    <!-- 포스트 목록 -->
    <div class="posts-section">
      <div class="divider"></div>
      <h3 class="text-xl font-bold mb-4">포스트 목록</h3>
      
      <!-- 포스트가 없는 경우 -->
      <div class="alert alert-info" th:if="${posts == null || posts.isEmpty()}">
        <i class="fa-solid fa-info-circle"></i>
        <div>
          <p>이 카테고리에는 아직 포스트가 없습니다.</p>
          <a th:href="@{/study-management/post/create(categoryId=${category.id})}" class="btn btn-sm btn-primary mt-2">
            <i class="fa-solid fa-plus"></i> 첫 포스트 작성하기
          </a>
        </div>
      </div>
      
      <!-- 포스트 목록 -->
      <div class="space-y-4" th:unless="${posts == null || posts.isEmpty()}">
        <div class="card bg-base-100 shadow" th:each="post : ${posts}">
          <div class="card-body">
            <div class="flex gap-4">
              <!-- 썸네일 이미지 (이미지 첨부 파일이 있는 경우) -->
              <div class="flex-shrink-0" th:if="${post.attachments != null && !post.attachments.isEmpty() && post.attachments[0].isImage}">
                <img th:src="${post.attachments[0].fileUrl}" alt="썸네일" class="w-24 h-24 object-cover rounded-lg">
              </div>
              
              <div class="flex-1">
                <a th:href="@{/study-management/post/{id}(id=${post.id})}" class="text-lg font-semibold hover:text-primary" th:text="${post.title}"></a>
                <div class="text-sm text-gray-500 mt-1">
                  <span th:text="${post.author != null ? post.author : '익명'}"></span>
                  <span class="mx-2">•</span>
                  <span th:text="${#temporals.format(post.createdDate, 'yyyy-MM-dd HH:mm')}"></span>
                  <span class="mx-2">•</span>
                  <span th:text="${'조회 ' + post.viewCount}"></span>
                </div>
                <div class="text-gray-600 mt-2" th:text="${post.summary != null ? post.summary : (post.content.length() > 200 ? post.content.substring(0, 200) + '...' : post.content)}"></div>
                <div class="flex justify-end gap-1 mt-2" th:if="${post.tagList != null && !post.tagList.isEmpty()}">
                  <span th:each="tag : ${post.tagList}" class="badge badge-sm" th:text="${tag}"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 페이지네이션 -->
      <div class="flex justify-center mt-6" th:if="${totalPages > 1}">
        <div class="join">
          <!-- 이전 페이지 -->
          <a class="join-item btn" th:classappend="${currentPage == 0 ? 'btn-disabled' : ''}"
             th:href="@{/study-management/category/{id}(id=${category.id},page=${currentPage - 1})}">
            <i class="fa-solid fa-angle-left"></i>
          </a>
          
          <!-- 페이지 번호 -->
          <a class="join-item btn" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
             th:classappend="${i == currentPage ? 'btn-active' : ''}"
             th:href="@{/study-management/category/{id}(id=${category.id},page=${i})}"
             th:text="${i + 1}"></a>
          
          <!-- 다음 페이지 -->
          <a class="join-item btn" th:classappend="${currentPage == totalPages - 1 ? 'btn-disabled' : ''}"
             th:href="@{/study-management/category/{id}(id=${category.id},page=${currentPage + 1})}">
            <i class="fa-solid fa-angle-right"></i>
          </a>
        </div>
      </div>
    </div>
    </div>
  </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<script>
  $(document).ready(function() {
    // 카테고리 페이지 관련 JavaScript 코드
  });
</script>
</body>
</html>
