<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head(title='Task 트래커 - D-Day & 진행 관리')}"></head>
<body class="task-tracker-page bg-gray-50">
<div th:replace="~{fragments/header :: header}"></div>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" id="main-content">
  <!-- 페이지 헤더 -->
  <div class="mb-6">
    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
      <i class="fa-solid fa-bullseye text-blue-500"></i>
      Task 트래커
    </h2>
    <p class="text-gray-500 mt-1">D-Day 관리 및 일일 진행 기록</p>
  </div>

  <!-- Task 목록 섹션 -->
  <div class="card bg-base-100 shadow-sm border border-gray-100 mb-6">
    <div class="card-body">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <div>
          <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
            <i class="fa-solid fa-list-check text-blue-500"></i>
            Task 목록
          </h3>
          <p class="text-gray-500 text-sm">등록된 Task 및 D-Day 관리</p>
        </div>
        <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
          <label class="label cursor-pointer gap-2 justify-start">
            <input type="checkbox" id="showCompleted" class="checkbox checkbox-sm checkbox-primary" onchange="loadGoals()">
            <span class="label-text text-sm">완료된 Task 표시</span>
          </label>
          <button class="btn btn-primary btn-sm sm:btn-md w-full sm:w-auto" onclick="showAddGoalModal()">
            <i class="fa-solid fa-plus"></i>
            Task 추가
          </button>
        </div>
      </div>

      <!-- Task 카드 그리드 -->
      <div id="taskGoalsContainer">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="taskGoalsGrid">
          <!-- 스켈레톤 로딩 -->
          <div class="skeleton h-48 w-full"></div>
          <div class="skeleton h-48 w-full"></div>
          <div class="skeleton h-48 w-full"></div>
          <div class="skeleton h-48 w-full"></div>
        </div>
        <div id="emptyGoalsMessage" class="hidden text-center py-12">
          <i class="fa-solid fa-clipboard-list text-6xl text-gray-300 mb-4"></i>
          <p class="text-gray-500">등록된 Task가 없습니다.</p>
          <button class="btn btn-primary btn-sm mt-4" onclick="showAddGoalModal()">
            <i class="fa-solid fa-plus"></i>
            첫 번째 Task 추가하기
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 진행 기록 섹션 -->
  <div class="card bg-base-100 shadow-sm border border-gray-100">
    <div class="card-body">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <div>
          <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
            <i class="fa-solid fa-clock-rotate-left text-blue-500"></i>
            진행 기록
          </h3>
          <p class="text-gray-500 text-sm">일일 학습/작업 기록</p>
        </div>
        <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
          <select id="progressGoalFilter" class="select select-bordered select-sm w-full sm:w-auto" onchange="loadProgress()">
            <option value="">전체 Task</option>
          </select>
          <button class="btn btn-outline btn-sm w-full sm:w-auto" onclick="loadProgress()">
            <i class="fa-solid fa-rotate"></i>
            새로고침
          </button>
        </div>
      </div>

      <!-- 진행 기록 타임라인 -->
      <div id="progressContainer">
        <!-- 데스크탑 테이블 (md 이상) -->
        <div class="hidden md:block overflow-x-auto">
          <table class="table table-zebra">
            <thead>
              <tr>
                <th>날짜</th>
                <th>Task</th>
                <th>내용</th>
                <th>범위</th>
                <th>메모</th>
                <th>액션</th>
              </tr>
            </thead>
            <tbody id="progressTable">
              <tr>
                <td colspan="6" class="text-center py-8">
                  <span class="loading loading-spinner loading-md text-primary"></span>
                  <span class="ml-2 text-gray-500">기록 로딩 중...</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- 모바일 카드 뷰 (md 미만) -->
        <div class="md:hidden space-y-3" id="progressCards">
          <div class="flex justify-center py-8">
            <span class="loading loading-spinner loading-md text-primary"></span>
            <span class="ml-2 text-gray-500">기록 로딩 중...</span>
          </div>
        </div>
        <div id="emptyProgressMessage" class="hidden text-center py-8">
          <i class="fa-solid fa-inbox text-4xl text-gray-300 mb-4"></i>
          <p class="text-gray-500">진행 기록이 없습니다.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Task 추가/수정 모달 -->
  <dialog class="modal" id="goalModal">
    <div class="modal-box w-11/12 max-w-2xl">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </form>
      <h3 class="font-bold text-lg flex items-center gap-2 mb-6" id="goalModalTitle">
        <i class="fa-solid fa-bullseye text-blue-500"></i>
        Task 추가
      </h3>
      <form id="goalForm" class="space-y-4">
        <input type="hidden" id="goalId" name="taskGoalId">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-control md:col-span-2">
            <label class="label">
              <span class="label-text font-medium">Task 이름 <span class="text-red-500">*</span></span>
            </label>
            <input type="text" id="goalTitle" name="title"
                   class="input w-full" placeholder="예: SQLD 자격증 준비" required>
          </div>
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">설명</span>
          </label>
          <textarea id="goalDescription" name="description"
                    class="textarea h-20" placeholder="Task에 대한 설명..."></textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">목표일 <span class="text-red-500">*</span></span>
            </label>
            <input type="date" id="goalTargetDate" name="targetDate"
                   class="input w-full" required>
          </div>
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">총 목표량</span>
            </label>
            <input type="number" id="goalTotalAmount" name="totalAmount"
                   class="input w-full" placeholder="예: 500" min="0">
          </div>
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">단위</span>
            </label>
            <select id="goalUnit" name="unit" class="select w-full">
              <option value="페이지">페이지</option>
              <option value="문제">문제</option>
              <option value="장">장</option>
              <option value="챕터">챕터</option>
              <option value="시간">시간</option>
              <option value="개">개</option>
              <option value="회">회</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">아이콘</span>
            </label>
            <select id="goalIcon" name="icon" class="select w-full">
              <option value="fa-solid fa-bullseye">🎯 목표</option>
              <option value="fa-solid fa-book">📚 책/학습</option>
              <option value="fa-solid fa-graduation-cap">🎓 시험</option>
              <option value="fa-solid fa-code">💻 코딩</option>
              <option value="fa-solid fa-dumbbell">💪 운동</option>
              <option value="fa-solid fa-pen">✏️ 글쓰기</option>
              <option value="fa-solid fa-briefcase">💼 프로젝트</option>
              <option value="fa-solid fa-certificate">📜 자격증</option>
              <option value="fa-solid fa-language">🌐 언어</option>
              <option value="fa-solid fa-star">⭐ 기타</option>
            </select>
          </div>
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">색상</span>
            </label>
            <select id="goalColor" name="color" class="select w-full">
              <option value="blue">파랑</option>
              <option value="green">초록</option>
              <option value="red">빨강</option>
              <option value="yellow">노랑</option>
              <option value="purple">보라</option>
              <option value="pink">핑크</option>
              <option value="orange">주황</option>
              <option value="gray">회색</option>
            </select>
          </div>
        </div>
      </form>
      <div class="modal-action">
        <form method="dialog">
          <button class="btn btn-ghost">취소</button>
        </form>
        <button class="btn btn-primary" onclick="saveGoal()">
          <i class="fa-solid fa-check"></i>
          저장
        </button>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <!-- 진행 기록 추가/수정 모달 -->
  <dialog class="modal" id="progressModal">
    <div class="modal-box w-11/12 max-w-xl">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </form>
      <h3 class="font-bold text-lg flex items-center gap-2 mb-6" id="progressModalTitle">
        <i class="fa-solid fa-clock text-blue-500"></i>
        진행 기록 추가
      </h3>
      <form id="progressForm" class="space-y-4">
        <input type="hidden" id="progressId" name="taskProgressId">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-control md:col-span-2">
            <label class="label">
              <span class="label-text font-medium">Task 선택 <span class="text-red-500">*</span></span>
            </label>
            <select id="progressGoalId" name="taskGoalId" class="select w-full" required>
              <option value="">Task를 선택하세요</option>
            </select>
          </div>
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">날짜 <span class="text-red-500">*</span></span>
          </label>
          <input type="date" id="progressDate" name="progressDate"
                 class="input w-full" required>
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">학습/작업 내용</span>
          </label>
          <input type="text" id="progressContent" name="content"
                 class="input w-full" placeholder="예: 1과목 데이터 모델링 학습">
        </div>

        <div class="form-control" id="rangeSliderContainer">
          <label class="label">
            <span class="label-text font-medium">진행 범위</span>
            <span class="label-text-alt text-primary font-semibold" id="rangeDisplay">0 ~ 0</span>
          </label>
          <div class="relative pt-6 pb-2">
            <div class="relative h-2 bg-gray-200 rounded-full" id="rangeTrack">
              <div class="absolute h-2 bg-primary rounded-full" id="rangeHighlight"></div>
              <input type="range" id="rangeSliderStart" name="startAmount"
                     class="range-slider absolute w-full h-2 appearance-none bg-transparent pointer-events-none"
                     min="0" max="100" value="0">
              <input type="range" id="rangeSliderEnd" name="endAmount"
                     class="range-slider absolute w-full h-2 appearance-none bg-transparent pointer-events-none"
                     min="0" max="100" value="0">
            </div>
          </div>
          <div class="flex justify-between text-xs text-gray-400 mt-1">
            <span id="rangeMin">0</span>
            <span id="rangeMax">100</span>
          </div>
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">메모</span>
          </label>
          <textarea id="progressMemo" name="memo"
                    class="textarea h-20" placeholder="오늘 학습 소감, 어려웠던 점 등..."></textarea>
        </div>

        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-3">
            <input type="checkbox" id="progressIsCompleted" name="isCompleted" class="checkbox checkbox-success">
            <span class="label-text">오늘 목표 달성</span>
          </label>
        </div>
      </form>
      <div class="modal-action">
        <form method="dialog">
          <button class="btn btn-ghost">취소</button>
        </form>
        <button class="btn btn-primary" onclick="saveProgress()">
          <i class="fa-solid fa-check"></i>
          저장
        </button>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>

  <!-- Task 상세 모달 -->
  <dialog class="modal" id="goalDetailModal">
    <div class="modal-box w-11/12 max-w-3xl">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </form>
      <div id="goalDetailContent">
        <div class="flex justify-center py-8">
          <span class="loading loading-spinner loading-lg text-primary"></span>
        </div>
      </div>
      <div class="modal-action">
        <form method="dialog">
          <button class="btn btn-ghost">닫기</button>
        </form>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<script th:src="@{/js/taskTracker.js}"></script>
</body>
</html>
